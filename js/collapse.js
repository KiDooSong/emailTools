// collapse generator
//random number to add to id
var randomID = Math.ceil(Math.random() * 1000000);
var css = "";
var end = "";
var m1 = '<!--[if (gte mso 9)|(IE)]> <table width="648" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td> <![endif]--> <table width="100%" border="0" cellpadding="0" cellspacing="0" class="" style="border: none; border-collapse: collapse; border-spacing: 0; max-width: 648px; mso-table-lspace: 0; mso-table-rspace: 0; width: 100%;" align="left"> <tr> <td class="p2" style="color: #888888; font-family: &#39;ClanPro-Medium&#39;, &#39;HelveticaNeue-Light&#39;, &#39;Helvetica Neue Light&#39;, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 24px; padding-bottom: 30px; padding-left: 15px; padding-right: 50px; padding-top: 30px; text-align: left;" contenteditable="true" id="m1">Friday and Saturday nights in the Marina</td> </tr> </table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]-->';
var m2 = '<table width="100%" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td style="padding-top:15px"> <!--[if (gte mso 9)|(IE)]> <table width="518" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td> <![endif]--> <table width="100%" border="0" cellpadding="0" cellspacing="0" class="" style="border:0;border-collapse:collapse;border-spacing:0;max-width:518px;mso-table-lspace:0;mso-table-rspace:0;width:100%" align="left"> <tr> <td class="p2" style="color:#888;font-family:&#39;ClanPro-Medium&#39;,&#39;HelveticaNeue-Light&#39;,&#39;Helvetica Neue Light&#39;,Helvetica,Arial,sans-serif;font-size:16px;line-height:24px;padding-bottom:15px;padding-left:15px;padding-right:50px;padding-top:15px;text-align:left" contenteditable="true" id="m1">Friday and Saturday nights in the Marina</td> </tr> </table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> <!--[if (gte mso 9)|(IE)]> </td> <td> <![endif]--> <!--[if (gte mso 9)|(IE)]> <table width="130" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td> <![endif]--> <table width="100%" border="0" cellpadding="0" cellspacing="0" class="" align="left" style="border:0;border-collapse:collapse;border-spacing:0;max-width:130px;mso-table-lspace:0;mso-table-rspace:0;width:100%"> <tr> <td style="color:#888;font-family:&#39;ClanPro-Medium&#39;,&#39;HelveticaNeue-Light&#39;,&#39;Helvetica Neue Light&#39;,Helvetica,Arial,sans-serif;font-size:16px;line-height:24px;padding-bottom:30px;padding-left:15px;padding-right:15px;padding-top:15px" class="p2 topp" contenteditable="true" id="m2">9PM&#8212;2AM</td> </tr> </table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> </td> </tr> </table>';
var m3 = '<table width="100%" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td style="padding-top:15px"> <!--[if (gte mso 9)|(IE)]> <table width="370" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td> <![endif]--> <table width="100%" border="0" cellpadding="0" cellspacing="0" class="" style="border:0;border-collapse:collapse;border-spacing:0;max-width:370px;mso-table-lspace:0;mso-table-rspace:0;width:100%" align="left"> <tr> <td class="p2" style="color:#888;font-family:&#39;ClanPro-Medium&#39;,&#39;HelveticaNeue-Light&#39;,&#39;Helvetica Neue Light&#39;,Helvetica,Arial,sans-serif;font-size:16px;line-height:24px;padding-bottom:15px;padding-left:15px;padding-right:50px;padding-top:15px;text-align:left" contenteditable="true" id="m1">Friday and Saturday nights in the Marina</td> </tr> </table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> <!--[if (gte mso 9)|(IE)]> </td> <td> <![endif]--> <!--[if (gte mso 9)|(IE)]> <table width="148" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td> <![endif]--> <table width="100%" border="0" cellpadding="0" cellspacing="0" class="" align="left" style="border:0;border-collapse:collapse;border-spacing:0;max-width:148px;mso-table-lspace:0;mso-table-rspace:0;width:100%"> <tr> <td style="color:#888;font-family:&#39;ClanPro-Medium&#39;,&#39;HelveticaNeue-Light&#39;,&#39;Helvetica Neue Light&#39;,Helvetica,Arial,sans-serif;font-size:16px;line-height:24px;padding-bottom:30px;padding-left:15px;padding-right:15px;padding-top:15px" class="p2 topp" contenteditable="true" id="m2">$40.00 / Hr</td> </tr> </table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> <!--[if (gte mso 9)|(IE)]> </td> <td> <![endif]--> <!--[if (gte mso 9)|(IE)]> <table width="130" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td> <![endif]--> <table width="100%" border="0" cellpadding="0" cellspacing="0" class="" align="left" style="border:0;border-collapse:collapse;border-spacing:0;max-width:130px;mso-table-lspace:0;mso-table-rspace:0;width:100%"> <tr> <td style="color:#888;font-family:&#39;ClanPro-Medium&#39;,&#39;HelveticaNeue-Light&#39;,&#39;Helvetica Neue Light&#39;,Helvetica,Arial,sans-serif;font-size:16px;line-height:24px;padding-bottom:30px;padding-left:15px;padding-right:15px;padding-top:15px" class="p2 topp" contenteditable="true" id="m3">9PM&#8212;2AM</td> </tr> </table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> </td> </tr> </table>';
var body = "";
var end = "";
var dropValue = "";
var bodyDropValue = "";
var output = "";
var arrowDown = "";
var arrowUp = "";
var bgcolr = "";
var col = "";

//Get dropdown val
function number(id) {
    var value = $('#' + id + '').val(); // The value of the selected option
    return value;
};
//asign top body
$('#numSelect').change(function set() {
    dropValue = number('numSelect');
    if (dropValue == 1) {
        body = m1;
    } else if (dropValue == 2) {
        body = m2;
    } else if (dropValue == 3) {
        body = m3;
    }
});

$('#contentSelect').change(function set() {
    bodyDropValue = number('contentSelect');
    console.log(bodyDropValue);
    if (bodyDropValue == 2) {
        // create show input
        $('#urlValueDiv').removeClass('hide');
        $('#urlValueDiv').addClass('show');
    } else if (bodyDropValue == 1) {
        $('#urlValueDiv').removeClass('show');
        $('#urlValueDiv').addClass('hide');
    }

});

//create code block
function compile() {
    // get collapse or not collapse
    col = $('input[name=collapse-group]:checked').val();
    if (col == "collapse"){
        css = '<style>@media screen and (max-width:510px) {input[type=checkbox]:not(:checked) ~ .content{max-height:0;overflow:hidden;transition:max-height .4s ease-out}label:before{right:20px!important}label:after{right:20px!important}input[type=checkbox]{position:absolute;top:0;left:0;opacity:0}label{cursor:pointer;position:relative;display:block;padding-left:0}.label-' + randomID + ':before{content:"";background:url("'+ arrowDown +'") no-repeat;background-color:blue;background-color:%%=v(@button_color)=%%;position:absolute;width:20px;height:14px;top:35px}input[type=checkbox]:checked ~ .label-' + randomID + ':before{content:"";background:url("'+ arrowUp +'") no-repeat;background-color:blue;background-color:%%=v(@button_color)=%%;position:absolute;width:20px;height:14px;top:35px}input[type=checkbox]:checked ~ .content{max-height:1000px}.topp{padding-top:15px!important;}}.hide-input{display:none}</style>';
    } else if (col == "sansCollapse"){
        css = "";
    }
    var imgUrl = number('urlValue');
    var start = '<div style="max-width:700px;"> <!--[if !mso]><!-- -->  <input type="checkbox" id="content-' + randomID + '" class="hide-input inputDropdown" style="display: none; max-height: 0px; mso-hide: all; overflow: hidden"> <!--<![endif]--> <label for="content-' + randomID + '" class="label-' + randomID + '" style="-outlook-checkbox-fix:1"> <table width="100%" border="0" cellpadding="0" cellspacing="0" class="" style="background-color: '+ bgcolr +'; border: none; border-collapse: collapse; border-spacing: 0; mso-table-lspace: 0; mso-table-rspace: 0; width: 100%;"> <tr> <td>';
    var textEnd = '</td> </tr> </table> </label> <div class="content" style="background-color:'+ bgcolr +';"> <table width="100%" border="0" cellpadding="0" cellspacing="0" class="" style="background-color: '+ bgcolr +'; border: none; border-collapse: collapse; border-spacing: 0; max-width: 672px; mso-table-lspace: 0; mso-table-rspace: 0; width: 100%;"> <tr> <td class="p1" style="color: #717172; font-family: &#39;ClanPro-Book&#39;, &#39;HelveticaNeue-Light&#39;, &#39;Helvetica Neue Light&#39;, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 28px; padding: 0 15px 30px;" id="divBody" contenteditable="true"> The Marinaâ€™s restaurants and bars attract riders from all over San Francisco on weekend nights.</td> </tr> </table> </div> </div>';
    var imgEnd = '</td> </tr> </table> </label> <div class="content" style="background-color:'+ bgcolr +'"> <table width="100%" border="0" cellpadding="0" cellspacing="0" class="" style="background-color:'+ bgcolr +';border:0;border-collapse:collapse;border-spacing:0;max-width:672px;mso-table-lspace:0;mso-table-rspace:0;width:100%"> <tr> <td style="padding:0 15px 30px" id="divBody"> <!--[if (gte mso 9)|(IE)]> <table width="280" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td> <![endif]--> <table width="100%" border="0" cellpadding="0" cellspacing="0" align="left" style="border:0;border-collapse:collapse;border-spacing:0;max-width:280px;mso-table-lspace:0;mso-table-rspace:0;width:100%"> <tr> <td style="padding-bottom:20px;padding-right:12px"> <img src="' + imgUrl + '" style="-ms-interpolation-mode:bicubic;border:0;clear:both;display:block;max-width:100%;outline:0;text-decoration:none" alt="" class=""/> </td> </tr> </table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> <!--[if (gte mso 9)|(IE)]> </td> <td width="336"> <![endif]--> <!--[if (gte mso 9)|(IE)]> <table width="336" align="left" cellpadding="0" cellspacing="0" border="0"> <tr> <td width="336" valign="top"> <![endif]--> <table width="100%" border="0" cellpadding="0" cellspacing="0" style="border:0;border-collapse:collapse;border-spacing:0;max-width:336px;mso-table-lspace:0;mso-table-rspace:0;width:100%" align="left"> <tr> <td contenteditable="true" style="color:#717172;font-family:&#39;ClanPro-Book&#39;,&#39;HelveticaNeue-Light&#39;,&#39;Helvetica Neue Light&#39;,Helvetica,Arial,sans-serif;font-size:16px;line-height:28px"> But I must explain to you how all this mistaken idea of denouncing pleasure and praising pain was born and text. </td> </tr> </table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> </td> </tr> </table> </div> </div>';

    // get body content value
    bodyDropValue = number('contentSelect');
     if (bodyDropValue == 1) {
        end = textEnd;
    } else if (bodyDropValue == 2) {
        end = imgEnd;
    }

   var code = css + start + body + end;
    return code;
};

$('#radio-1, #radio-2').change(function() {

    bgcolr = $('input[name=radio-group]:checked').val();
    if (bgcolr == '#ffffff') {
        arrowDown = 'https://s3.amazonaws.com/uber-static/emails/2016/08/chev-down.png';
        arrowUp = 'https://s3.amazonaws.com/uber-static/emails/2016/08/chev-up.png';
    } else if (bgcolr == '#f1f1f1') {
        arrowDown = 'https://s3.amazonaws.com/uber-static/emails/2016/08/chev-down_gray.png';
        arrowUp = 'https://s3.amazonaws.com/uber-static/emails/2016/08/chev-up_gray.png';
    }

});
//output to iframe
function toFrame() {
    output = compile();
    var ifrm = document.getElementById('output');
    ifrm = ifrm.contentWindow || ifrm.contentDocument.document || ifrm.contentDocument;
    ifrm.document.open();
    ifrm.document.write(output);
    ifrm.document.close();
    document.getElementById("livePrev").style.display = 'inline-block';
};

//put into code
function update(){
var css = document.getElementById('output').contentWindow.document.head.innerHTML
var html = document.getElementById('output').contentWindow.document.body.innerHTML
output = css + html
var boardCode = output.replace(/contenteditable="true"/g, "contenteditable='false'")
boardCode = boardCode.replace(/\</g, '&lt;');
  var finalCode = boardCode;
  document.getElementById("code").innerHTML = finalCode;

};

// update code
$('#updateButton').click(function(){
update();
$('#codePrev, #code, #refresh').addClass("block");
$('#updateButton').html('Update Code');
})

//clipboard code
var clipboard = new Clipboard('#htmlButton');
clipboard.on('success', function(e) {
  console.log(e);
});
clipboard.on('error', function(e) {
  console.log(e);
});

//mobile preview
$(document).ready(function() {
    $("#mobileButton").click(function() {
        $("#output").addClass("mobileDiv").removeClass("desktopDiv");
        $("#mobileButton").parent().addClass("activeF");
        $("#desktopButton").parent().removeClass("activeF");
       update();
    });
});
$(document).ready(function() {
    $("#desktopButton").click(function() {
        $("#output").addClass("desktopDiv").removeClass("mobileDiv");
        $("#desktopButton").parent().addClass("activeF");
        $("#mobileButton").parent().removeClass("activeF");
        update();
    });
});